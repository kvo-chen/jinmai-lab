var i=Object.defineProperty;var o=(r,t,e)=>t in r?i(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>o(r,typeof t!="symbol"?t+"":t,e);class c{constructor(){a(this,"user",null);a(this,"sessionId");a(this,"isEnabled",!0);this.sessionId=this.generateSessionId(),this.initializeAnalytics()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeAnalytics(){localStorage.getItem("analytics_dev_enable"),localStorage.getItem("analytics_opt_out")==="true"&&(this.isEnabled=!1),this.trackPageView()}trackPageView(){this.isEnabled&&this.trackEvent("page_view",{path:window.location.pathname,referrer:document.referrer,title:document.title,url:window.location.href,session_id:this.sessionId})}setUser(t){this.user=t}trackEvent(t,e={}){if(!this.isEnabled)return;const s={event:t,properties:{...e,session_id:this.sessionId,user_agent:navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,url:window.location.href,path:window.location.pathname,referrer:document.referrer,timestamp:new Date().toISOString(),...this.user&&{user_id:this.user.id,username:this.user.username,email:this.user.email}},timestamp:new Date().toISOString()};this.sendEvent(s)}async sendEvent(t){try{const e=await fetch("/api/analytics/track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`)}catch(e){console.warn("Failed to send analytics event:",e),this.storeEventLocally(t)}}storeEventLocally(t){const e=JSON.parse(localStorage.getItem("analytics_events")||"[]");e.push(t),e.length>100&&e.shift(),localStorage.setItem("analytics_events",JSON.stringify(e))}async flushStoredEvents(){const t=JSON.parse(localStorage.getItem("analytics_events")||"[]");if(t.length===0)return;const e=[];for(const s of t)try{await apiClient.trackAnalyticsEvent(s.event,s.properties)}catch{e.push(s)}localStorage.setItem("analytics_events",JSON.stringify(e))}optOut(){this.isEnabled=!1,localStorage.setItem("analytics_opt_out","true"),this.trackEvent("analytics_opt_out")}optIn(){this.isEnabled=!0,localStorage.removeItem("analytics_opt_out"),this.trackEvent("analytics_opt_in")}getSessionId(){return this.sessionId}isAnalyticsEnabled(){return this.isEnabled}trackUserLogin(t,e){this.trackEvent("user_login",{method:t,success:e})}trackUserLogout(){this.trackEvent("user_logout")}trackWorkCreation(t,e){this.trackEvent("work_created",{work_id:t,work_type:e})}trackWorkView(t,e){this.trackEvent("work_viewed",{work_id:t,work_title:e})}trackWorkLike(t,e,s){this.trackEvent("work_liked",{work_id:t,work_title:e,liked:s})}trackWorkComment(t,e){this.trackEvent("work_commented",{work_id:t,work_title:e})}trackUserFollow(t,e,s){this.trackEvent("user_followed",{target_user_id:t,target_username:e,followed:s})}trackSocialNavigation(t){this.trackEvent("social_navigation",{section:t})}trackError(t,e){this.trackEvent("error_occurred",{error:t,context:e})}trackFeatureUsage(t,e){this.trackEvent("feature_used",{feature:t,action:e})}}const n=new c,u=(r,t)=>n.trackEvent(r,t),h=(r,t)=>n.trackWorkView(r,t),k=(r,t,e)=>n.trackUserFollow(r,t,e);export{h as a,k as b,u as t};
