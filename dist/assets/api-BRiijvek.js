var i={};const o="/api";class c{getHeaders(){const e=localStorage.getItem("token");return{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}}async handleResponse(e){let t=null;if((e.headers.get("content-type")||"").includes("application/json"))try{t=await e.json()}catch{t=null}else try{const a=await e.text();t=a?JSON.parse(a):null}catch{t=null}if(!e.ok)throw new Error(t&&t.error||`请求失败(${e.status})`);return t}async post(e,t){const s=await fetch(`${o}${e}`,{method:"POST",headers:this.getHeaders(),body:t?JSON.stringify(t):void 0});return this.handleResponse(s)}async get(e){const t=await fetch(`${o}${e}`,{method:"GET",headers:this.getHeaders()});return this.handleResponse(t)}async put(e,t){const s=await fetch(`${o}${e}`,{method:"PUT",headers:this.getHeaders(),body:t?JSON.stringify(t):void 0});return this.handleResponse(s)}async delete(e){const t=await fetch(`${o}${e}`,{method:"DELETE",headers:this.getHeaders()});return this.handleResponse(t)}async login(e,t){return this.post("/auth/login",{email:e,password:t})}async register(e,t,s){return this.post("/auth/register",{username:e,email:t,password:s})}async getCurrentUser(){return this.get("/auth/me")}async updateProfile(e,t){return this.put("/auth/profile",{username:e,avatar:t})}async checkEmail(e){return this.post("/auth/check-email",{email:e})}async requestPhoneCode(e){return this.post("/auth/request-phone-code",{phone:e})}async loginWithPhone(e,t){return this.post("/auth/login-phone",{phone:e,code:t})}async loginWithWeChat(){return this.post("/auth/login-wechat")}async likeWork(e){return this.post(`/works/${e}/like`)}async getWorkLikeStatus(e){return this.get(`/works/${e}/like-status`)}async getWorkComments(e){return this.get(`/works/${e}/comments`)}async addComment(e,t){return this.post(`/works/${e}/comments`,{content:t})}async likeComment(e){return this.post(`/comments/${e}/like`)}async followUser(e){return this.post(`/social/follow/${e}`)}async getFollowing(){return this.get("/social/following")}async getFollowers(){return this.get("/social/followers")}async getSocialFeed(){return this.get("/social/feed")}}const l=new c,r={track:(n,e)=>{try{const t=typeof process<"u"&&i&&!1,s=localStorage.getItem("analytics_dev_enable");console.log("[Analytics]",n,e),fetch(`${o}/analytics/track`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({event:n,properties:e,timestamp:Date.now(),userId:localStorage.getItem("userId"),sessionId:localStorage.getItem("sessionId")})}).catch(console.error)}catch(t){console.error("埋点错误:",t)}},page:(n,e)=>{r.track("page_view",{page:n,...e})},user:(n,e)=>{r.track(`user_${n}`,e)}};export{r as a,l as b};
